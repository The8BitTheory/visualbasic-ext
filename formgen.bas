#RetroDevStudio.MetaData.BASIC:7169,BASIC V7.0,uppercase,10,10
10 GRAPHIC0:PRINT"";

12 DEF FN HB(ZZ)=INT(ZZ/256)
14 DEF FN LB(ZZ)=ZZ-INT(ZZ/256)*256

16 DD=PEEK(186)

20 TT=0
30 T$=" ILE  RDER  ENERATE "
35 TL(0)=4:TL(1)=5:TL(2)=8
40 PRINT T$;
50 TT=TT+LEN(T$)
60 ML=TT

# FX:FORM-ELEMENT-ID
# FX$:FORM ELEMENT TEXT CONTENT (ASSUMING AN ELEMENT HAS 1 TEXT PROPERTY MAX)
# PF:PROPERTIES PER FORM-TYPE-ID
#    1=FRAME. 
# FO:FORM-ELEMENT OFFSETS FOR VRAM
62 DIM FX(254,9),FX$(254),PF(3),FO(254)

63 PF(1)=6:PF(2)=6:PF(3)=7


70 SP$="                                                                                "


# BOTTOM BORDER
80 BD$(2)=""



#########
# SPECS #
#########
# FORM FILE
# 0-1: VB (FILE FORMAT INFO)
# 2-3: LENGTH OF DATA TO COPY TO VRAM (MENU AND FORM VISUALS)
# 4-N: VISUAL DATA
# N-M: MENUDATA
#  M+1: TOP-MENU LENGTH
#  M+2: TOP-MENU ELEMENT COUNT
#  M+3-M+9: MENUDATA (6 BYTES EACH)

# M-O: FORMDATA
#  O+1: FORM ELEMENT COUNT
#  O+2-3: OFFSET TO ELEMENT ID #0
#  O+2*ID - 2*ID+1
# P=O+1+(VALUE FROM O+1*2)



########
# MENU #
########

90 DIM MN$(2,5),MO%(2,2)

100 MN$(0,0)="EW          +":MN$(0,1)="OAD         +"
110 MN$(0,2)="AVE         +":MN$(0,3)="AVE AS...   +"
120 MN$(0,4)="-----------------":MN$(0,5)="XIT         +"

130 MN$(1,0)="BY       1":MN$(1,1)="BY AME    3"
140 MN$(1,2)="BY CORE   5":MN$(1,3)="EVERSE    7"

150 MN$(2,0)="COREBOARD   +":MN$(2,1)="RINTFOX   +"
160 MN$(2,2)="          +"

170 MO%(0,1)=6:MO%(1,1)=4:MO%(2,1)=3


200 FOR TM=0 TO 2
201  MO%(TM,0)=TT

205  T$=""+LEFT$(BD$(2),LEN(MN$(TM,0))+2)+""
206  TT=TT+LEN(T$)
207  PRINT T$;

210  FOR SM = 0 TO 5
215   IF LEN(MN$(TM,SM))=0 THEN 225

220   T$= " "+MN$(TM,SM)+" "
221   TT=TT+LEN(T$)
222   PRINT T$;

225  NEXT

230  T$=""+LEFT$(BD$(2),LEN(MN$(TM,0))+2)+""
235  TT=TT+LEN(T$)
240  PRINT T$;

250 NEXT



########
# FORM #
########

# FORM ELEMENT PROPERTIES
# ID (GIVEN BY ARRAY INDEX OF FIRST DIMENSION)
# 0: TYPE
# 1-2: INVISIBLE VRAM-OFFSET
# 3:XPOS
# 4:YPOS
# 5:WIDTH
# 6:HEIGHT

# MAIN-FRAME OF PROGRAM
#   TYPE=1
300 FX(0,0)=1

#   XPOS AND YPOS
303 FX(0,1)=0:FX(0,2)=0

#   WIDTH AND HEIGHT IN CHARACTER-BLOCKS
304 FX(0,3)=80:FX(0,4)=25

306 FX$(0)="OWER OMPETITION ANAGER"


# LABEL "MY FIRST LABEL"
310 FX(1,0)=2
#   X,Y
314 FX(1,1)=3:FX(1,2)=3
316 FX(1,3)=15:FX(1,4)=1

319 FX$(1)="Y FIRST ABEL"

# INPUT "MY FIRST INPUT"
320 FX(2,0)=3
#   X,Y
324 FX(2,1)=40:FX(2,2)=3
#   WIDTH AND HEIGHT
326 FX(2,3)=18:FX(2,4)=1
#   MAX ALLOWED LENGTH OF TEXT CONTENT
327 FX(2,5)=16

328 FX$(2)="Y FIRST NPUT"



# ITERATE OVER FORM ELEMENT VISUALS
500 FOR FE = 0 TO 2
510  FO(FE)=TT

#    FRAME
520  IF FX(FE,0)=1 THEN T$=FX$(FE)

#    LABEL
525  IF FX(FE,0)=2 THEN T$=FX$(FE)

#    INPUT
530  IF FX(FE,0)=3 THEN T$="["+FX$(FE)+LEFT$(SP$,FX(FE,3)-2-LEN(FX$(FE)))+"]"

540  TT=TT+LEN(T$)

545  PRINT T$;

550 NEXT



# WRITE DATA FILE
10000 DOPEN #1,"@FORM.DATA,P",U(DD),W

# HEADER. FILE FORMAT BYTES
10010 PRINT#1,"VB";

# LENGTH OF MENU VISUALS
10020 PRINT#1,CHR$(FN LB(TT))CHR$(FNHB(TT));

# ITERATE THROUGH VIC-II RAM AND PEEK SCREEN CODES
10030 BANK0

10040 FOR I=1024 TO 1024+TT-1
10050  V=PEEK(I)
10060  PRINT#1, CHR$(V);
10070 NEXT

# TOP-MENU LENGTH
10080 PRINT#1,CHR$(ML);

# TOP-MENU COUNT
10090 PRINT#1,CHR$(3);


10100 TS=0

# MENU-POPUP DATA
10110 FOR TM=0 TO 2
#    2 BYTES OFFSET IN VRAM-MENUDATA
10120  PRINT#1,CHR$(FNLB(MO%(TM,0)))CHR$(FNHB(MO%(TM,0)));

#    1 BYTE OFFSET FROM LEFT BORDER
10130  PRINT#1,CHR$(TS);:TS=TS+TL(TM)+2

#    1 BYTE LENGTH OF TOP-MENU ENTRY
10140  PRINT#1,CHR$(TL(TM)+2);

#    1 BYTE NR OF MENU LINES
10150  PRINT#1,CHR$(MO%(TM,1)+2);

#    1 BYTE LENGTH OF LINE
10160  PRINT#1,CHR$(LEN(MN$(TM,0))+4);

10170 NEXT

10200 FOR FE = 0 TO 2

#      TYPE OF FORM ELEMENT
10202  PRINT#1,CHR$(FX(FE,0));


#      BYTES OFFSET OF TEXT-CONTENT LENGTH IN VRAM-FORMDATA
10205  PRINT#1,CHR$(FNLB(FO(FE)))CHR$(FNHB(FO(FE)));

#      XPOS AND YPOS
10210  PRINT#1,CHR$(FX(FE,1))CHR$(FX(FE,2));

#      WIDTH AND HEIGHT
10215  PRINT#1,CHR$(FX(FE,3))CHR$(FX(FE,4));

#      MAX-CONTENT LENGTH
10220  IF FX(FE,0)=3 THEN PRINT#1,CHR$(FX(FE,5));

#      TEXT-CONTENT LENGTH (CAPTION, VALUE, ETC)
10225  PRINT#1,CHR$(LEN(FX$(FE)));

#      TEXT CONTENT
#10230  PRINT#1,FX$(FE);


10250 NEXT

10990 DCLOSE#1